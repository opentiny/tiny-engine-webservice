<p align="center">
  <a href="https://opentiny.design/tiny-engine" target="_blank" rel="noopener noreferrer">
    <img alt="OpenTiny Logo" src="logo.svg" height="100" style="max-width:100%;">
  </a>
</p>

<p align="center">Tiny Engine Web Serviceæ˜¯ä¸€ä¸ªRESTful APIï¼Œè´Ÿè´£å‘å‰ç«¯æä¾›æ•°æ®æœåŠ¡ã€ä»£ç ç”ŸæˆæœåŠ¡å’Œä»£ç å‘å¸ƒæœåŠ¡ã€‚å®ƒä¸ç›´æ¥åœ¨æ•°æ®åº“ä¸Šæ“ä½œï¼Œæ•°æ®æ“ä½œè¯·æ±‚TinyEngine Data Center æ•°æ®ä¸­å¿ƒçš„æ¥å£</p>

[English](README.md) | ç®€ä½“ä¸­æ–‡

### ç›®å½•è§„åˆ™

å¼€å‘å‰éœ€è¦äº†è§£é¡¹ç›®æ•´ä½“ç›®å½•ç»“æ„ï¼Œå¹¶æŒ‰ç…§å¦‚ä¸‹è§„åˆ™å»è¿›è¡Œç›®å½•è§„åˆ™ç¼–å†™ä»£ç 

```
â”œâ”€â”€ README.md
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ controller                      // controller
â”‚   â”‚   â””â”€â”€ ä¸šåŠ¡æ§åˆ¶å™¨                    // å…·ä½“å“ªä¸ªä¸šåŠ¡å»ºç«‹è‡ªå·±çš„ä¸šåŠ¡æ–‡ä»¶å¤¹ï¼Œå¦‚æœæ˜¯å…¬ç”¨ä¸šåŠ¡è¯·æŠŠè¿™ä¸ªæ–‡ä»¶å¤¹å‘½åcommon
â”‚   â”‚       â”œâ”€â”€ api.js                  // apiæ–‡ä»¶ä¸»è¦å¤„ç†æ¥å£ç›¸å…³çš„é€»è¾‘
â”‚   â”‚       â””â”€â”€ page.js                 // pageæ–‡ä»¶ä¸»è¦å¤„ç†é¡µé¢çš„é€»è¾‘
â”‚   â”œâ”€â”€ extend
â”‚   â”‚   â””â”€â”€ helper.js                   // controllerä¸­çš„æ‰€æœ‰å…¬å…±æ–¹æ³•å¯ä»¥æŠ½åˆ°helperé‡Œé¢é€šè¿‡ this.ctx.helper.xxx å¼•ç”¨
â”‚   â”œâ”€â”€ middleware                      // è¿™éƒ¨åˆ†ä¸­é—´ä»¶å¿…é¡»æ˜¯å…¬å…±é€»è¾‘(å¤šè¯­è¨€å¤„ç†ä¹‹ç±»çš„ï¼Œè®°å¾—è¦æ ¹æ®jsonè¿˜æ˜¯htmlè¿›è¡ŒåŒºåˆ†å¤„ç†)ï¼Œä¸šåŠ¡é€»è¾‘ä¸è¦æ”¾åˆ°ä¸­é—´ä»¶é‡Œé¢ï¼Œå„è‡ªä¸šåŠ¡å…¬å…±æ–¹æ³•å¯ä»¥åœ¨helperé‡Œé¢åˆ†è‡ªå·±ä¸šåŠ¡ç©ºé—´å®šä¹‰é€šç”¨çš„å¤„ç†é€»è¾‘
â”‚   â”œâ”€â”€ public                          // é™æ€æ–‡ä»¶ç›®å½•ï¼Œé‡Œé¢çš„èµ„æºæœ¬åœ°å¼€å‘é˜¶æ®µå¯ä»¥é€šè¿‡/public/æ–¹å¼è®¿é—®åˆ°ï¼Œä½†æ˜¯å‘å¸ƒçº¿ä¸Šè®°å¾—è¦åœ¨ç½‘å…³å±‚è¿›è¡Œé…ç½®/public/ç›®å‰çš„æƒé™ï¼ˆè¿™é‡Œå»ºè®®é™æ€èµ„æºæ”¾åˆ°cdnï¼‰ã€‚
â”‚   â”‚   â””â”€â”€ ä¸šåŠ¡çš„é™æ€èµ„æº                // é™æ€ç›®å½•ä¹Ÿè¦é€šè¿‡æ–‡ä»¶å¤¹åŒºåˆ†å…·ä½“çš„ä¸šåŠ¡ç±»å‹ï¼Œè¿™é‡Œdocæ˜¯æ–‡æ¡£ä¸­å¿ƒçš„ä¸šåŠ¡ï¼ŒçŸ¥è¯†åº“åˆ™å»ºç«‹zhishiæ–‡å¤¹
â”‚   â”‚       â”œâ”€â”€ css
â”‚   â”‚       â”œâ”€â”€ images
â”‚   â”‚       â””â”€â”€ js
â”‚   â”œâ”€â”€ router                          // è·¯ç”±æ ¹æ®ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼Œæ‰€æœ‰è·¯ç”±éƒ½å¿…é¡»è¦æœ‰è‡ªå·±ä¸šåŠ¡å‰ç¼€ï¼Œé™¤äº†commoné€šç”¨å¤„ç†ä»¥å¤–å…¶ä»–ä¸šåŠ¡ç¦æ­¢ä½¿ç”¨/*è¿™ç§å…¨å±€è·¯ç”±ï¼Œè€Œé‡‡ç”¨/ä¸šåŠ¡åç§°/*è¿™ç§è·¯ç”±æ¥å¤„ç†å„è‡ªä¸šåŠ¡ä¸‹çš„é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ common.js                   // commonè¿™ä¸ªjsä¸»è¦å¤„ç†æ ¹ç›®å½•/*ä¸‹è·¯ç”±ç­‰æƒ…å†µï¼Œå…¶ä»–ä¸šåŠ¡é€»è¾‘ç¦æ­¢æ”¾åˆ°è¿™é‡Œé¢
â”‚   â”‚   â””â”€â”€ ä¸šåŠ¡çš„è·¯ç”±.js
â”‚   â”œâ”€â”€ service                         // serviceè·ŸcontrolleråŒç†ï¼Œæ ¹æ®ä¸šåŠ¡åˆ’åˆ†ã€‚
â”‚   â”‚   â””â”€â”€ ä¸šåŠ¡ç›¸å…³çš„åç«¯æ¥å£æœåŠ¡          // ä¸šåŠ¡ä¸­ä½¿ç”¨åˆ°è·Ÿåç«¯å¯¹æ¥ç›¸å…³æ¥å£ï¼Œæ ¹æ®ä¸šåŠ¡åˆ’åˆ†
â”‚   â”‚       â””â”€â”€ ä¸šåŠ¡æ‰€ä¾èµ–çš„å…·ä½“æœåŠ¡çš„æ¥å£é€»è¾‘.js
â”‚   â””â”€â”€ view                            // viewå­˜æ”¾çš„æ˜¯ejsæ¨¡ç‰ˆï¼Œæ ¹æ®ä¸šåŠ¡å…·ä½“åˆ’åˆ†æ–‡ä»¶ç›®å½•ï¼ˆä¸šåŠ¡ä¸‹å†æ ¹æ®è¯­è¨€ç›®å½•åˆ’åˆ†ä¸åŒæ¨¡ç‰ˆï¼‰ï¼Œå…¶commonå’Œerroråˆ†åˆ«ä¸ºå…¬å…±å¸ƒå±€ä»¥åŠé”™è¯¯å¤„ç†ã€‚
â”‚       â”œâ”€â”€ common                      // commonå­˜æ”¾å…¬å…±å¸ƒå±€æ–‡ä»¶ï¼ˆheader/footer/sidecarç­‰ï¼‰ï¼Œå„ä¸ªä¸šåŠ¡å¯ä»¥åœ¨è‡ªå·±éœ€è¦çš„æ—¶includeè¿›åˆ°è‡ªå·±ä¸šåŠ¡ä¸­
â”‚       â”‚   â”œâ”€â”€ en-us                   // å…¬å…±è‹±æ–‡çš„æ¨¡ç‰ˆ
â”‚       â”‚   â”‚   â””â”€â”€ index.tpl
â”‚       â”‚   â””â”€â”€ zh-cn                   // å…¬å…±ä¸­æ–‡çš„æ¨¡ç‰ˆ
â”‚       â”‚       â”œâ”€â”€ footer.tpl
â”‚       â”‚       â””â”€â”€ header.tpl
â”‚       â”œâ”€â”€ ä¸šåŠ¡è‡ªå·±çš„æ¨¡ç‰ˆ                 // æ–‡æ¡£ä¸­å¿ƒçš„ä¸šåŠ¡æ¨¡ç‰ˆ
â”‚       â”‚   â”œâ”€â”€ en-us
â”‚       â”‚   â”‚   â””â”€â”€ index.tpl
â”‚       â”‚   â””â”€â”€ zh-cn
â”‚       â”‚       â”œâ”€â”€ 404.html
â”‚       â”‚       â”œâ”€â”€ content
â”‚       â”‚       â”‚   â”œâ”€â”€ catalog.tpl
â”‚       â”‚       â”‚   â””â”€â”€ content.tpl
â”‚       â”‚       â””â”€â”€ pages.tpl
â”‚       â””â”€â”€ error                        // errorç›®å½•å­˜æ”¾é”™è¯¯å¤„ç†æ–‡ä»¶ï¼Œå¦‚404 500è¿™ç§é”™è¯¯å¯ä»¥æ”¾åˆ°è¿™é‡Œé¢æ¥ï¼ŒåŒæ—¶ä¹Ÿä¼šæ ¹æ®è¯­è¨€è¿›è¡Œåˆ’åˆ†
â”‚           â”œâ”€â”€ en-us
â”‚           â”‚   â””â”€â”€ 404.tpl
â”‚           â””â”€â”€ zh-cn
â”‚               â””â”€â”€ 404.tpl
â”œâ”€â”€ config                               // é¡¹ç›®é…ç½® æ ¹æ®ä¸åŒç¯å¢ƒä¼šåŠ è½½ä¸åŒé…ç½®
â”‚   â”œâ”€â”€ config.default.js                // è¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯é»˜è®¤é…ç½®ï¼Œæ˜¯å…¶ä»–configæ–‡ä»¶å®šä¹‰ä¹‹åæ ¹æ®ç¯å¢ƒä¸åŒä¼šé€šè¿‡Object.assig(config.defalut.js,config.xxxx.js)æ–¹å¼åˆå¹¶ã€‚æ‰€ä»¥ä¸åŒç¯å¢ƒå…¬å…±çš„é…ç½®å…¨åˆå¹¶åˆ°è¿™é‡Œï¼Œå…¶ä»–configåšè‡ªå·±å®šåˆ¶åŒ–å¤„ç†å³å¯ã€‚
â”‚   â”œâ”€â”€ config.local.js                  // åªéœ€è¦é…ç½®æœ¬åœ°ç›¸å…³çš„ä¸€äº›å·®å¼‚åŒ–é…ç½®
â”‚   â”œâ”€â”€ config.prod.js
â”‚   â””â”€â”€ plugin.js                       // æ’ä»¶å¼€å…³ç›®å½•ï¼Œæ ¹æ®å®é™…éœ€è¦å»å¼€å…³è‡ªå·±çš„æ’ä»¶
â”œâ”€â”€ logs                                // æœ¬åœ°å¼€å‘æ—¥å¿—çš„è¾“å‡ºç›®å½•
â”œâ”€â”€ package.json
â”œâ”€â”€ test                                // æµ‹è¯•ç”¨ä¾‹ï¼Œé‡‡ç”¨BDDæ–¹å¼è¿›è¡Œæµ‹è¯•ç”¨ä¾‹ç¼–å†™
â”‚   â””â”€â”€ ä¸šåŠ¡æµ‹è¯•ç”¨ä¾‹                      // ä¸šåŠ¡ç›¸å…³æµ‹è¯•ç”¨ä¾‹
â”‚        â”œâ”€â”€ controller.test.js         // æ ¹æ®è¯­è¨€ç»´åº¦è¿›è¡Œæµ‹è¯•/æ ¹æ®æ¥å£æ˜¯å¦200è¿›è¡Œæµ‹è¯•
â”‚        â””â”€â”€ service.test.js            // æ ¹æ®æœåŠ¡è¿”å›æ¥å£æ˜¯å¦æ­£å¸¸ï¼Œé€šè¿‡assertæ–­è¨€åº“è¿›è¡Œæµ‹è¯•
â””â”€â”€ typings                             // eggä½¿ç”¨typescriptä¸´æ—¶ç”Ÿæˆçš„ä¸€äº›å®šä¹‰æ–‡ä»¶ï¼Œæ—¥å¸¸å¼€å‘å¯ä»¥å¿½ç•¥ã€‚
```


### æ¥å£è¿”å›è§„èŒƒ

##### 1.è¿”å›æ ¼å¼

- æ­£å¸¸æ•°æ®
```js
{
    "locale": "zh-cn",
    "data": {
      "app": {
        "count": 100
      }
    }
}
```
- é”™è¯¯æ•°æ®
```js
{
    "locale": "zh-cn",
    "data": {},
    "error": {
      "code": "CM002",
      "message": "name ä¸èƒ½ä¸ºç©º",
    }
}
```
##### 2.å¦‚ä½•ä¿è¯é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯å‡†ç¡®æ€§

- eggæ¥å£èµ°é€šï¼Œé™¤ä¸šåŠ¡å±‚è¿”å›403é‡ç™»å½•å¤–ï¼ŒhttpçŠ¶æ€ç å‡ä¸º200ï¼Œå¼‚å¸¸åŸå› ä½“ç°åœ¨errorï¼›
- è¯æ¡å›½é™…åŒ–ï¼šåœ¨config/locale ä¸­æŒç»­è¡¥å……å¯¹åº”é”™è¯¯ç å’Œè¯æ¡å†…å®¹
- ä¸è¯·æ±‚data-centerçš„æ¥å£ï¼Œç›´æ¥è°ƒç”¨helper.commonJson()è¿”å›æ•°æ®
- è¯·æ±‚data-centerçš„æ¥å£ï¼š
```js
    // è°ƒç”¨å¯¹åº”serviceæ–¹æ³•ï¼Œå‘èµ·queryè¯·æ±‚ï¼ŒdataServiceä¼šè°ƒç”¨helper.getResponseData()
    // getResponseDataä¼šå°†data-centerå›ä¼ çš„é”™è¯¯ä¿¡æ¯è¿›è¡Œè§„èŒƒåŒ–è½¬æ¢
    const createRes = await platforms.createPlatform(body);
    // å¦‚æœé€šç”¨çš„é”™è¯¯æç¤ºä¸èƒ½ä½“ç°å‡ºå­—æ®µï¼Œå¯å¯¹å·²ç»è·å¾—æ•°æ®å†åŠ å·¥
    // formatResponseå¯è¿›è¡Œé€»è¾‘æ‰©å±•
    this.ctx.body = this.ctx.helper.formatResponse(createRes, 'name');
```
##### 3.å‚æ•°å­—æ®µæ ¡éªŒ

- åœ¨eggæœåŠ¡å±‚æ¥å£ä½¿ç”¨validateè¿›è¡Œå­—æ®µå¿…è¦æ€§å’Œæ ¼å¼æ ¡éªŒï¼Œé¿å…è¿™ç§é”™è¯¯åœ¨strapiæŠ›å‡ºï¼Œå¯¹æ•°æ®æ ¼å¼æœ‰ç‰¹æ®Šè¦æ±‚çš„å¯ä»¥åœ¨app/validateæ·»åŠ è§„åˆ™

##### 4.é”™è¯¯å¤„ç†ä¸­é—´ä»¶

- åœ¨ä¸­é—´ä»¶errorResponse.tsä¸­è¡¥å……é”™è¯¯æ‹¦æˆªå¤„ç†ï¼›æœåŠ¡ç«¯æœ¬èº«å¯¼è‡´çš„å¼‚å¸¸ä¼šæ•è·å¹¶è¿”å›500, 

### ä½¿ç”¨æ‰‹å†Œ

å…·ä½“æœåŠ¡ç«¯ä½¿ç”¨æ–‡æ¡£è¯·æŸ¥çœ‹[TinyEngine å®˜ç½‘-ä½¿ç”¨æ‰‹å†Œ](https://opentiny.design/tiny-engine#/help-center/course/backend/51)

### å¼€å‘

#### ç¯å¢ƒå˜é‡

|å˜é‡åç§°|è¯´æ˜
|---|---|
|GIT_USERNAME|åº”ç”¨å‘å¸ƒæ—¶å…·å¤‡pushä»£ç æƒé™çš„ä»£ç ä»“ç”¨æˆ·å|
|GIT_EMAIL|åº”ç”¨å‘å¸ƒæ—¶å…·å¤‡pushä»£ç æƒé™çš„ä»£ç ä»“çš„ç”¨æˆ·é‚®ç®±|
|GIT_USER_TOKEN|åº”ç”¨å‘å¸ƒæ—¶å…·å¤‡pushä»£ç æƒé™çš„ä»£ç ä»“token|
|GIT_REPO|åº”ç”¨å‘å¸ƒæ—¶çš„ä»£ç ä»“åœ°å€|
|GIT_BRANCH|åº”ç”¨å‘å¸ƒæ—¶é»˜è®¤æäº¤ä»£ç çš„åˆ†æ”¯|
|DATA_CENTER_URL|æ•°æ®ä¸­å¿ƒåœ°å€ï¼Œä¾‹å¦‚ï¼š https://www.mydatacenter.com|
|PROXY_SERVER|é€‰æ‹©æ€§è®¾ç½®ï¼Œå¦‚æœè‡ªå·±çš„æœåŠ¡å™¨éœ€è¦ä»£ç†æœåŠ¡æ‰èƒ½è®¿é—®å¤–éƒ¨æ•°æ®ï¼Œéœ€è¦é…ç½®ä»£ç†æœåŠ¡çš„åœ°å€|
|OPENAI_API_KEY|AIæ¥å£ openaiçš„ API key|
|WENXIN_ACCESS_TOKEN|AIæ¥å£ æ–‡å¿ƒä¸€è¨€çš„access_token (30å¤©ä¸€æ›´æ–°)|
|NPM_AUTH_TOKEN|npmjs.com çš„ç”¨æˆ·å…·å¤‡publishæƒé™çš„authToken, ç”¨æˆ·å‘å¸ƒåŒºå—|

ä»¥ä¸‹ä¸ºå‚è€ƒç¯å¢ƒå˜é‡é…ç½®é¡¹ï¼š

obs é…ç½®
æ­¤æ¬¡å¼€æºä»£ç æä¾›äº†æ­é…åä¸ºäº‘obsçš„ä½¿ç”¨ç¤ºä¾‹ï¼š

|å˜é‡åç§°|è¯´æ˜
|---|---|
|OBS_AK|obs AK æœ¬ç¤ºä¾‹ä»£ç ä½¿ç”¨åä¸ºäº‘obsï¼Œå¦‚æœä½¿ç”¨å…¶ä»–äº‘æœåŠ¡äº§å“è¯·æœç´¢ç›¸å…³ä»£ç ä¿®æ”¹é€»è¾‘é€‚é…|
|OBS_SK|obs SK æœ¬ç¤ºä¾‹ä»£ç ä½¿ç”¨åä¸ºäº‘obsï¼Œå¦‚æœä½¿ç”¨å…¶ä»–äº‘æœåŠ¡äº§å“è¯·æœç´¢ç›¸å…³ä»£ç ä¿®æ”¹é€»è¾‘é€‚é…|
|OBS_ACCESS_URL|obsçš„èµ„æºè®¿é—®urlï¼Œä¾‹å¦‚ï¼šhttps://tinyengine.obs.cn-north-4.myhuaweicloud.com/somepath/somefile.tar.gz|
|OBS_SERVICE_URL|ä½¿ç”¨obs sdkæ—¶ä¼ å…¥çš„obsæœåŠ¡é“¾æ¥å‚æ•°ï¼Œä¾‹å¦‚ï¼šhttps://obs.cn-north-4.myhuaweicloud.com|

RabbitMQ é…ç½®
æ­¤æ¬¡å¼€æºä»£ç æä¾›äº†è¿æ¥RabbitMQä»»åŠ¡é˜Ÿåˆ—çš„ä½¿ç”¨ç¤ºä¾‹ï¼ˆå¼€æºä»£ç ä¸­RabbitMQ æ’ä»¶å¤„äºå…³é—­çŠ¶æ€ï¼Œå¦‚æœéœ€è¦è¯·å¼€å¯ã€‚ åŒæ—¶æ¢å¤é¡¹ç›®æ ¹ç›®å½•ä¸‹app.tsä¸­è¢«æ³¨é‡Šçš„ä»£ç ï¼‰ï¼š

|å˜é‡åç§°|è¯´æ˜
|---|---|
|MQ_IP|	ä»»åŠ¡é˜Ÿåˆ—æœåŠ¡ipåœ°å€|
|MQ_PORT|	ä»»åŠ¡é˜Ÿåˆ—æœåŠ¡ç«¯å£ï¼Œä¾‹å¦‚ 5671|
|MQ_USERNAME|	ä»»åŠ¡é˜Ÿåˆ—æœåŠ¡ç”¨æˆ·å|
|MQ_PASSWORD|	ä»»åŠ¡é˜Ÿåˆ—æœåŠ¡å¯†ç |

å¦‚æœæ¶‰åŠåˆ°è‡ªèº«æœåŠ¡çš„CI/CD éƒ¨ç½² æˆ–å®¹å™¨åŒ–éƒ¨ç½²è¯·æ ¹æ®è‡ªèº«æ‰€å±äº§å“ã€å·¥å…·çš„ç‰¹ç‚¹æŒ‰ç…§ä¸Šé¢çš„æ¸…å•é…ç½®ç¯å¢ƒå˜é‡ï¼›

#### æœ¬åœ°è¿è¡Œæ—¶é…ç½®æ–¹å¼ï¼š

git-bash æˆ– bash
```
vi ~/.bashrc
```

```
export MQ_IP=192.168.0.11
export MQ_PORT=5671
# ç­‰ç­‰ç¯å¢ƒå˜é‡
```
è®¾ç½®å®Œåï¼Œé‡æ–°æ‰“å¼€å‘½ä»¤è¡Œæˆ–åˆ™åœ¨å½“å‰å‘½ä»¤è¡Œæ‰§è¡Œ
```
source ~/.bashrc
```
è®©è®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼›(git bashä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡æ— æ³•é€‚ç”¨äºpowershell å’Œcmd)
å¯åŠ¨é¡¹ç›®

nodejsç‰ˆæœ¬é€‰æ‹©ï¼š >= 16

è¿›å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä¸€æ¬¡æ‰§è¡Œï¼š
```
yarn install --ignore-engines
npm run dev
```

### é‡Œç¨‹ç¢‘

```mermaid
gantt 
dateFormat YYYY-MM-DD
axisFormat %Y-%m-%d

	1.0.0-beta.x version	:active,2023-09-25, 2024-03-31
	1.0.0-rc	version    :       2024-04-01, 2024-06-30
	1.0.0 version   :          2024-07-01, 2024-07-31

```

### ğŸ¤ å‚ä¸è´¡çŒ®

å¦‚æœä½ å¯¹æˆ‘ä»¬çš„å¼€æºé¡¹ç›®æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬ï¼ğŸ‰

å‚ä¸è´¡çŒ®ä¹‹å‰è¯·å…ˆé˜…è¯»[è´¡çŒ®æŒ‡å—](CONTRIBUTING.zh-CN.md)ã€‚

- æ·»åŠ å®˜æ–¹å°åŠ©æ‰‹å¾®ä¿¡ opentiny-officialï¼ŒåŠ å…¥æŠ€æœ¯äº¤æµç¾¤
- åŠ å…¥é‚®ä»¶åˆ—è¡¨ opentiny@googlegroups.com

### å¼€æºåè®®

[MIT](LICENSE)
